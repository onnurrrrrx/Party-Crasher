<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Party-Crasher - H√ºpfburg Verleih</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .bounce-animation { animation: bounce 2s infinite; }
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        .surface-btn.selected {
            border-color: #8b5cf6 !important;
            background-color: #f3f4f6 !important;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        .service-btn.selected {
            border-color: #8b5cf6 !important;
            background-color: #f3f4f6 !important;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        .service-btn.selected .text-purple-600 {
            color: #059669 !important;
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4 bounce-animation">üè∞</div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Party-Crasher</h1>
                <p class="text-gray-600">H√ºpfburg Verleih Management</p>
            </div>
            
            <div class="space-y-4">
                <button onclick="showEmployeeLogin()" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    üë• Mitarbeiter Zugang
                </button>
                <button onclick="showAdminLogin()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    üîê Admin Zugang
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Password Screen -->
    <div id="adminPasswordScreen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md">
            <div class="text-center mb-8">
                <div class="text-4xl mb-4">üîê</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Admin Zugang</h2>
                <p class="text-gray-600">Passwort eingeben</p>
            </div>
            
            <div class="space-y-4">
                <input type="password" id="adminPassword" placeholder="Admin Passwort" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                <button onclick="checkAdminPassword()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-200">
                    Anmelden
                </button>
                <button onclick="backToLogin()" class="w-full bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-3 px-6 rounded-lg transition duration-200">
                    Zur√ºck
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden min-h-screen">
        <nav class="bg-gradient-to-r from-purple-600 to-blue-600 shadow-xl">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="bg-white rounded-full p-2 shadow-lg">
                            <span class="text-2xl">üè∞</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-white">Party-Crasher</h1>
                            <p class="text-purple-100 text-sm">Admin Dashboard</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-2">
                        <button onclick="showTab('overview')" id="overviewTab" class="px-4 py-2.5 bg-white bg-opacity-20 text-white rounded-lg font-medium hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center space-x-2">
                            <span>üìä</span>
                            <span>√úbersicht</span>
                        </button>
                        <button onclick="showTab('orders')" id="ordersTab" class="px-4 py-2.5 bg-white bg-opacity-10 text-white rounded-lg font-medium hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center space-x-2">
                            <span>üìã</span>
                            <span>Auftr√§ge</span>
                        </button>
                        <button onclick="showTab('settings')" id="settingsTab" class="px-4 py-2.5 bg-white bg-opacity-10 text-white rounded-lg font-medium hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center space-x-2">
                            <span>‚öôÔ∏è</span>
                            <span>Einstellungen</span>
                        </button>
                        <button onclick="logout()" class="px-4 py-2.5 bg-red-500 bg-opacity-90 text-white rounded-lg font-medium hover:bg-opacity-100 transition-all duration-200 flex items-center justify-center space-x-2 shadow-lg">
                            <span>üö™</span>
                            <span>Abmelden</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Overview Tab -->
        <div id="overviewContent" class="max-w-7xl mx-auto p-6">
            <h2 class="text-2xl font-bold text-white mb-6">H√ºpfburgen √úbersicht</h2>
            <div id="bounceCastleList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Bounce castles will be populated here -->
            </div>
        </div>

        <!-- Orders Tab -->
        <div id="ordersContent" class="hidden max-w-7xl mx-auto p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">Auftrags√ºbersicht</h2>
                <button onclick="exportOrders()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium">
                    üì§ JSON Export
                </button>
            </div>
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div id="ordersList" class="divide-y divide-gray-200">
                    <!-- Orders will be populated here -->
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settingsContent" class="hidden max-w-7xl mx-auto p-6">
            <h2 class="text-2xl font-bold text-white mb-6">Einstellungen</h2>
            <div class="bg-white rounded-lg shadow-lg p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Zusatzkosten Asphalt</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Pauschale (‚Ç¨)</label>
                                <input type="number" id="asphaltFee" value="30" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Kabeltrommel (‚Ç¨)</label>
                                <input type="number" id="cableFee" value="5" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Auf-/Abbau Service (‚Ç¨)</label>
                                <input type="number" id="serviceFee" value="45" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold mb-4">Fahrtkosten</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">0-3 km (‚Ç¨)</label>
                                <input type="number" id="travel0to3" value="10" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">bis 5 km (‚Ç¨)</label>
                                <input type="number" id="travel5" value="15" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">bis 10 km (‚Ç¨)</label>
                                <input type="number" id="travel10" value="20" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">bis 20 km (‚Ç¨)</label>
                                <input type="number" id="travel20" value="40" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ab 20 km (‚Ç¨/km)</label>
                                <input type="number" step="0.01" id="travelPerKm" value="2.40" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                            </div>
                        </div>
                    </div>
                </div>
                <button onclick="saveSettings()" class="mt-6 bg-purple-500 hover:bg-purple-600 text-white px-6 py-2 rounded-lg font-medium">
                    Einstellungen Speichern
                </button>
            </div>
        </div>
    </div>

    <!-- Employee Dashboard -->
    <div id="employeeDashboard" class="hidden min-h-screen">
        <nav class="bg-gradient-to-r from-blue-600 to-green-600 shadow-xl">
            <div class="max-w-7xl mx-auto px-4">
                <div class="flex justify-between items-center py-4">
                    <div class="flex items-center space-x-4">
                        <div class="bg-white rounded-full p-2 shadow-lg">
                            <span class="text-2xl">üè∞</span>
                        </div>
                        <div>
                            <h1 class="text-xl font-bold text-white">Party-Crasher</h1>
                            <p class="text-blue-100 text-sm">Mitarbeiter Dashboard</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="importData()" class="px-3 py-2 bg-white bg-opacity-20 text-white rounded-lg font-medium hover:bg-opacity-30 transition-all duration-200 flex items-center space-x-1 shadow-lg text-sm">
                            <span>üì•</span>
                            <span>Import</span>
                        </button>
                        <button onclick="logout()" class="px-3 py-2 bg-red-500 bg-opacity-90 text-white rounded-lg font-medium hover:bg-opacity-100 transition-all duration-200 flex items-center space-x-1 shadow-lg text-sm">
                            <span>üö™</span>
                            <span>Abmelden</span>
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-7xl mx-auto p-6">
            <h2 class="text-2xl font-bold text-white mb-6">Gebuchte H√ºpfburgen</h2>
            <div id="employeeBookingsList" class="space-y-4">
                <!-- Employee bookings will be populated here -->
            </div>
        </div>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">H√ºpfburg Buchen</h3>
                    <button onclick="closeBookingModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>

                <form id="bookingForm" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">H√ºpfburg</label>
                            <input type="text" id="selectedCastle" readonly class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Kunde</label>
                            <input type="text" id="customerName" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Von (Datum)</label>
                            <input type="date" id="startDate" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Bis (Datum)</label>
                            <input type="date" id="endDate" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Aufbauzeit</label>
                            <input type="time" id="setupTime" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Abbauzeit</label>
                            <input type="time" id="teardownTime" required class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Untergrund *</label>
                        <div class="grid grid-cols-2 gap-3">
                            <button type="button" id="grassBtn" onclick="selectSurface('grass')" class="surface-btn p-4 border-2 border-gray-300 rounded-lg text-center hover:border-green-500 hover:bg-green-50 transition-all duration-200">
                                <div class="text-2xl mb-2">üå±</div>
                                <div class="font-medium">Rasen</div>
                                <div class="text-sm text-gray-500">Standard</div>
                            </button>
                            <button type="button" id="asphaltBtn" onclick="selectSurface('asphalt')" class="surface-btn p-4 border-2 border-gray-300 rounded-lg text-center hover:border-blue-500 hover:bg-blue-50 transition-all duration-200">
                                <div class="text-2xl mb-2">üõ£Ô∏è</div>
                                <div class="font-medium">Asphalt</div>
                                <div class="text-sm text-green-600">+30‚Ç¨ Pauschale</div>
                            </button>
                        </div>
                        <input type="hidden" id="surface" required>
                    </div>

                    <div id="additionalServices">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Zusatzleistungen</label>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                            <button type="button" id="kabeltrommelBtn" onclick="toggleService('kabeltrommel')" class="service-btn p-4 border-2 border-gray-300 rounded-lg text-center hover:border-purple-500 hover:bg-purple-50 transition-all duration-200">
                                <div class="text-2xl mb-2">üîå</div>
                                <div class="font-medium">Kabeltrommel</div>
                                <div class="text-sm text-green-600">+5‚Ç¨</div>
                            </button>
                            <button type="button" id="aufbauServiceBtn" onclick="toggleService('aufbauService')" class="service-btn p-4 border-2 border-gray-300 rounded-lg text-center hover:border-purple-500 hover:bg-purple-50 transition-all duration-200">
                                <div class="text-2xl mb-2">üîß</div>
                                <div class="font-medium">Auf-/Abbau Service</div>
                                <div class="text-sm text-green-600">+45‚Ç¨</div>
                            </button>
                            <button type="button" id="poolBtn" onclick="toggleService('pool')" class="service-btn p-4 border-2 border-gray-300 rounded-lg text-center hover:border-purple-500 hover:bg-purple-50 transition-all duration-200 hidden">
                                <div class="text-2xl mb-2">üèä</div>
                                <div class="font-medium">Pool</div>
                                <div class="text-sm text-green-600">+25‚Ç¨</div>
                            </button>
                        </div>
                        <input type="hidden" id="asphaltPauschale">
                        <input type="hidden" id="kabeltrommel">
                        <input type="hidden" id="aufbauService">
                        <input type="hidden" id="pool">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Adresse (f√ºr Fahrtkosten) *</label>
                        <input type="text" id="address" required placeholder="Stra√üe, PLZ Ort" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        <input type="hidden" id="distance">
                        <div id="travelCostInfo" class="mt-2 text-sm text-gray-600"></div>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-3">Ben√∂tigte Materialien</label>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-3">
                            <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="material_geblaese" class="material-checkbox">
                                <span class="text-sm">üå™Ô∏è Gebl√§se</span>
                            </label>
                            <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="material_verlaengerung" class="material-checkbox">
                                <span class="text-sm">üîå Verl√§ngerungskabel</span>
                            </label>
                            <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="material_heringe" class="material-checkbox">
                                <span class="text-sm">‚öíÔ∏è Heringe</span>
                            </label>
                            <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="material_sandsaecke" class="material-checkbox">
                                <span class="text-sm">üèãÔ∏è Sands√§cke</span>
                            </label>
                            <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="material_plane" class="material-checkbox">
                                <span class="text-sm">üõ°Ô∏è Schutzplane</span>
                            </label>
                            <label class="flex items-center space-x-2 p-2 border rounded-lg hover:bg-gray-50">
                                <input type="checkbox" id="material_reparaturset" class="material-checkbox">
                                <span class="text-sm">üîß Reparaturset</span>
                            </label>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Zus√§tzliche Materialien / Notizen</label>
                            <textarea id="additionalMaterials" rows="3" placeholder="z.B. extra Kabeltrommel, spezielle Werkzeuge, Besonderheiten..." class="w-full px-3 py-2 border border-gray-300 rounded-md"></textarea>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Rabatt (%)</label>
                            <input type="number" id="discountPercent" min="0" max="100" placeholder="z.B. 10" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Rabatt (‚Ç¨)</label>
                            <input type="number" id="discountAmount" min="0" step="0.01" placeholder="z.B. 25.00" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                    </div>

                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-gray-800 mb-3">Kosten√ºbersicht</h4>
                        <div id="costBreakdown" class="space-y-2 text-sm">
                            <!-- Cost breakdown will be populated here -->
                        </div>
                        <div class="border-t pt-2 mt-3">
                            <div class="flex justify-between font-bold text-lg">
                                <span>Gesamtsumme:</span>
                                <span id="totalCost">0,00 ‚Ç¨</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-4">
                        <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg">
                            Buchung Best√§tigen
                        </button>
                        <button type="button" onclick="closeBookingModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-3 px-6 rounded-lg">
                            Abbrechen
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- JSON Import Modal -->
    <div id="importModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold text-gray-800">JSON Daten Importieren</h3>
                    <button onclick="closeImportModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">JSON Daten einf√ºgen:</label>
                        <textarea id="jsonInput" rows="15" placeholder='{"orders": [...], "bounceCastles": [...], "settings": {...}}' 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md font-mono text-sm"></textarea>
                    </div>
                    
                    <div class="bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">üí° Hinweise:</h4>
                        <ul class="text-sm text-blue-700 space-y-1">
                            <li>‚Ä¢ JSON Daten aus einem Export hier einf√ºgen</li>
                            <li>‚Ä¢ Bestehende Daten werden √ºberschrieben</li>
                            <li>‚Ä¢ Format wird automatisch √ºberpr√ºft</li>
                        </ul>
                    </div>
                    
                    <div class="flex space-x-4">
                        <button onclick="processJsonImport()" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg">
                            üì• Daten Importieren
                        </button>
                        <button onclick="closeImportModal()" class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-3 px-6 rounded-lg">
                            Abbrechen
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Booking Confirmation Modal -->
    <div id="confirmationModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="text-center mb-6">
                    <div class="text-6xl mb-4">‚úÖ</div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">Buchung Erfolgreich!</h3>
                    <p class="text-gray-600">Ihre Buchung wurde erfolgreich gespeichert.</p>
                </div>

                <div id="bookingSummary" class="bg-gray-50 rounded-lg p-4 mb-6">
                    <!-- Booking summary will be populated here -->
                </div>

                <button onclick="closeConfirmationModal()" class="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg">
                    Schlie√üen
                </button>
            </div>
        </div>
    </div>



    <script>
        // Application state
        let currentUser = null;
        let bounceCastles = [
            { 
                id: 1, 
                name: "Summer Party", 
                weekdayPrice: 99, 
                weekendPrice: 129, 
                threeDayPrice: 245,
                status: "available",
                dimensions: "4,9m x 4m x 4m",
                capacity: "bis zu 8 Kids",
                features: "mit Rutsche",
                setupTime: "ca. 15min",
                weight: "100kg",
                transport: "minimum Kombi",
                selfPickup: true
            },
            { 
                id: 2, 
                name: "Hawaii Box", 
                weekdayPrice: 99, 
                weekendPrice: 129, 
                threeDayPrice: 245,
                status: "available",
                dimensions: "4,8m x 4m x 3,5m",
                capacity: "bis zu 8 Kids",
                features: "mit Rutsche & Hindernisse",
                setupTime: "ca. 15min",
                weight: "100kg",
                transport: "minimum Kombi",
                selfPickup: true
            },
            { 
                id: 3, 
                name: "Fu√üball H√ºtte", 
                weekdayPrice: 139, 
                weekendPrice: 179, 
                threeDayPrice: 295,
                status: "available",
                dimensions: "5,5m x 5m x 4,6m",
                capacity: "bis zu 12 Kids",
                features: "mit Rutsche & Hindernisse",
                setupTime: "ca. 25min",
                weight: "160kg",
                transport: "minimum Caddy",
                selfPickup: false
            },
            { 
                id: 4, 
                name: "Haifisch Becken", 
                weekdayPrice: 139, 
                weekendPrice: 179, 
                threeDayPrice: 295,
                status: "available",
                dimensions: "5,4m x 5m x 3,8m",
                capacity: "bis zu 12 Kids",
                features: "mit Rutsche & Hindernisse, auch als Wasserrutsche nutzbar",
                setupTime: "ca. 25min",
                weight: "160kg",
                transport: "minimum Caddy",
                selfPickup: false,
                poolExtra: 25
            },
            { 
                id: 5, 
                name: "Piratenschiff", 
                weekdayPrice: 99, 
                weekendPrice: 129, 
                threeDayPrice: 245,
                status: "available",
                dimensions: "6,2m x 3,8m x 3,6m",
                capacity: "bis zu 8 Kids",
                features: "mit Rutsche & Hindernisse",
                setupTime: "ca. 15min",
                weight: "80kg",
                transport: "minimum Kombi",
                selfPickup: true
            },
            { 
                id: 6, 
                name: "Dino Doubleslide", 
                weekdayPrice: 145, 
                weekendPrice: 195, 
                threeDayPrice: 320,
                status: "available",
                dimensions: "5,4m x 6,2m x 3,4m",
                capacity: "bis zu 15 Kids",
                features: "mit Doppelrutsche & Hindernisse, auch als Wasserrutsche nutzbar",
                setupTime: "ca. 25min",
                weight: "185kg",
                transport: "minimum Caddy",
                selfPickup: false,
                poolExtra: 25
            },
            { 
                id: 7, 
                name: "Monster-Truck Doubleslide", 
                weekdayPrice: 145, 
                weekendPrice: 195, 
                threeDayPrice: 320,
                status: "available",
                dimensions: "5,4m x 6,2m x 3,4m",
                capacity: "bis zu 15 Kids",
                features: "mit Doppelrutsche & Hindernisse, auch als Wasserrutsche nutzbar",
                setupTime: "ca. 25min",
                weight: "185kg",
                transport: "minimum Caddy",
                selfPickup: false,
                poolExtra: 25
            },
            { 
                id: 8, 
                name: "Wedding Bouncer", 
                weekdayPrice: 159, 
                weekendPrice: 189, 
                threeDayPrice: 295,
                status: "available",
                dimensions: "4m x 4m x 3m",
                capacity: "bis zu 8 Kids",
                features: "mit Rutsche & B√§llebad, selbst gestalten! Ballons nicht im Preis enthalten",
                setupTime: "ca. 25min",
                weight: "130kg",
                transport: "minimum Kombi",
                selfPickup: true
            },
            { 
                id: 9, 
                name: "PAW Bouncer", 
                weekdayPrice: 109, 
                weekendPrice: 139, 
                threeDayPrice: 250,
                status: "available",
                dimensions: "5m x 3,5m x 3,6m",
                capacity: "bis zu 10 Kids",
                features: "mit Rutsche",
                setupTime: "ca. 15min",
                weight: "95kg",
                transport: "minimum Kombi",
                selfPickup: true
            },
            { 
                id: 10, 
                name: "PAW Kidszone", 
                weekdayPrice: 139, 
                weekendPrice: 179, 
                threeDayPrice: 295,
                status: "available",
                dimensions: "6m x 4m x 3,4m",
                capacity: "bis zu 15 Kids",
                features: "perfekt f√ºr kleine Kids, B√§lle Bad, H√ºpfburg & Rutsche",
                setupTime: "ca. 20min",
                weight: "85kg",
                transport: "Aufbau/Abbau Lieferung nur durch uns",
                selfPickup: false
            },
            { 
                id: 11, 
                name: "Minnie Clubhouse", 
                weekdayPrice: 89, 
                weekendPrice: 119, 
                threeDayPrice: 200,
                status: "available",
                dimensions: "3m x 3,5m x 2m",
                capacity: "bis zu 6 Kids",
                features: "mit Rutsche",
                setupTime: "ca. 10min",
                weight: "85kg",
                transport: "minimum Kombi",
                selfPickup: true
            },
            { 
                id: 12, 
                name: "Mickey Clubhouse", 
                weekdayPrice: 79, 
                weekendPrice: 99, 
                threeDayPrice: 180,
                status: "available",
                dimensions: "3m x 2m x 2m",
                capacity: "bis zu 3-4 Kids",
                features: "mit Rutsche",
                setupTime: "ca. 10min",
                weight: "25kg",
                transport: "kann im Kleinwagen transportiert werden",
                selfPickup: true
            },
            { 
                id: 13, 
                name: "Super Hero", 
                weekdayPrice: 109, 
                weekendPrice: 139, 
                threeDayPrice: 250,
                status: "available",
                dimensions: "5m x 4m x 3,8m",
                capacity: "bis zu 8 Kids",
                features: "mit Rutsche & Hindernisse",
                setupTime: "ca. 20min",
                weight: "110kg",
                transport: "minimum Kombi",
                selfPickup: true
            },
            { 
                id: 14, 
                name: "Mickey Bouncer", 
                weekdayPrice: 109, 
                weekendPrice: 139, 
                threeDayPrice: 250,
                status: "available",
                dimensions: "5m x 3,5m x 3,6m",
                capacity: "bis zu 10 Kids",
                features: "mit Rutsche & Hindernisse",
                setupTime: "ca. 15min",
                weight: "95kg",
                transport: "minimum Kombi",
                selfPickup: true
            },
            { 
                id: 15, 
                name: "Mario World XXL", 
                weekdayPrice: 145, 
                weekendPrice: 195, 
                threeDayPrice: 320,
                status: "available",
                dimensions: "5,5m x 5,5m x 6m",
                capacity: "bis zu 15 Kids",
                features: "mit riesen Rutsche & Hindernisse",
                setupTime: "ca. 20min",
                weight: "158kg",
                transport: "minimum Caddy",
                selfPickup: false
            },
            { 
                id: 16, 
                name: "Mario Bouncer", 
                weekdayPrice: 109, 
                weekendPrice: 139, 
                threeDayPrice: 250,
                status: "available",
                dimensions: "5m x 3,5m x 3,6m",
                capacity: "bis zu 10 Kids",
                features: "mit Rutsche & Hindernisse",
                setupTime: "ca. 15min",
                weight: "95kg",
                transport: "minimum Kombi",
                selfPickup: true
            }
        ];
        let orders = [];
        let settings = {
            asphaltFee: 30,
            cableFee: 5,
            serviceFee: 45,
            travel0to3: 10,
            travel5: 15,
            travel10: 20,
            travel20: 40,
            travelPerKm: 2.40
        };

        // Load data from localStorage
        function loadData() {
            const savedOrders = localStorage.getItem('partyCrasherOrders');
            const savedSettings = localStorage.getItem('partyCrasherSettings');
            const savedCastles = localStorage.getItem('partyCrasherCastles');
            
            if (savedOrders) orders = JSON.parse(savedOrders);
            if (savedSettings) settings = Object.assign(settings, JSON.parse(savedSettings));
            if (savedCastles) bounceCastles = JSON.parse(savedCastles);
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('partyCrasherOrders', JSON.stringify(orders));
            localStorage.setItem('partyCrasherSettings', JSON.stringify(settings));
            localStorage.setItem('partyCrasherCastles', JSON.stringify(bounceCastles));
        }

        // Initialize app
        function init() {
            loadData();
            updateCastleStatuses();
        }

        // Login functions
        function showEmployeeLogin() {
            currentUser = 'employee';
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('employeeDashboard').classList.remove('hidden');
            renderEmployeeBookings();
        }

        function showAdminLogin() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('adminPasswordScreen').classList.remove('hidden');
        }

        function checkAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'admin123') {
                currentUser = 'admin';
                document.getElementById('adminPasswordScreen').classList.add('hidden');
                document.getElementById('adminDashboard').classList.remove('hidden');
                renderBounceCastles();
                loadSettingsToForm();
            } else {
                alert('Falsches Passwort!');
            }
        }

        function backToLogin() {
            document.getElementById('adminPasswordScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminPassword').value = '';
        }

        function logout() {
            currentUser = null;
            document.getElementById('adminDashboard').classList.add('hidden');
            document.getElementById('employeeDashboard').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('adminPassword').value = '';
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all content
            document.getElementById('overviewContent').classList.add('hidden');
            document.getElementById('ordersContent').classList.add('hidden');
            document.getElementById('settingsContent').classList.add('hidden');
            
            // Reset tab styles
            document.getElementById('overviewTab').className = 'px-4 py-2.5 bg-white bg-opacity-10 text-white rounded-lg font-medium hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center space-x-2';
            document.getElementById('ordersTab').className = 'px-4 py-2.5 bg-white bg-opacity-10 text-white rounded-lg font-medium hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center space-x-2';
            document.getElementById('settingsTab').className = 'px-4 py-2.5 bg-white bg-opacity-10 text-white rounded-lg font-medium hover:bg-opacity-20 transition-all duration-200 flex items-center justify-center space-x-2';
            
            // Show selected content and highlight tab
            if (tabName === 'overview') {
                document.getElementById('overviewContent').classList.remove('hidden');
                document.getElementById('overviewTab').className = 'px-4 py-2.5 bg-white bg-opacity-20 text-white rounded-lg font-medium hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center space-x-2 ring-2 ring-white ring-opacity-50';
                renderBounceCastles();
            } else if (tabName === 'orders') {
                document.getElementById('ordersContent').classList.remove('hidden');
                document.getElementById('ordersTab').className = 'px-4 py-2.5 bg-white bg-opacity-20 text-white rounded-lg font-medium hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center space-x-2 ring-2 ring-white ring-opacity-50';
                renderOrders();
            } else if (tabName === 'settings') {
                document.getElementById('settingsContent').classList.remove('hidden');
                document.getElementById('settingsTab').className = 'px-4 py-2.5 bg-white bg-opacity-20 text-white rounded-lg font-medium hover:bg-opacity-30 transition-all duration-200 flex items-center justify-center space-x-2 ring-2 ring-white ring-opacity-50';
            }
        }

        // Update castle availability status
        function updateCastleStatuses() {
            // All castles are always available for booking
            // Double booking prevention is handled in the booking form
            bounceCastles.forEach(castle => {
                castle.status = 'available';
            });
        }

        // Render bounce castles
        function renderBounceCastles() {
            updateCastleStatuses();
            const container = document.getElementById('bounceCastleList');
            container.innerHTML = '';
            
            bounceCastles.forEach(castle => {
                container.innerHTML += `
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="text-4xl mb-4 text-center">üè∞</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">${castle.name}</h3>
                        <div class="space-y-2 mb-4">
                            <p class="text-xs text-gray-500">${castle.dimensions} ‚Ä¢ ${castle.capacity}</p>
                            <p class="text-xs text-gray-600">${castle.features}</p>
                            <p class="text-xs text-gray-500">Aufbau: ${castle.setupTime} ‚Ä¢ ${castle.weight}</p>
                            <p class="text-xs text-gray-500">${castle.transport}</p>
                            ${castle.poolExtra ? `<p class="text-xs text-orange-600">Pool +${castle.poolExtra}‚Ç¨ extra</p>` : ''}
                            <div class="border-t pt-2 mt-3">
                                <p class="text-sm text-gray-600">Mo-Do: <span class="font-semibold">${castle.weekdayPrice}‚Ç¨</span></p>
                                <p class="text-sm text-gray-600">Fr-So: <span class="font-semibold">${castle.weekendPrice}‚Ç¨</span></p>
                                <p class="text-sm text-gray-600">3 Tage: <span class="font-semibold">${castle.threeDayPrice}‚Ç¨</span></p>
                            </div>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800">Verf√ºgbar</span>
                            <button onclick="openBookingModal(${castle.id})" 
                                    class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg font-medium">
                                Buchen
                            </button>
                        </div>
                    </div>
                `;
            });
        }

        // Surface selection function
        function selectSurface(surface) {
            // Reset all surface buttons
            document.getElementById('grassBtn').classList.remove('selected');
            document.getElementById('asphaltBtn').classList.remove('selected');
            
            // Select the chosen surface
            document.getElementById(surface + 'Btn').classList.add('selected');
            document.getElementById('surface').value = surface;
            
            // Auto-select asphalt pauschale when asphalt is selected
            if (surface === 'asphalt') {
                document.getElementById('asphaltPauschale').value = 'true';
            } else {
                document.getElementById('asphaltPauschale').value = '';
            }
            
            calculateCosts();
        }

        // Service toggle function
        function toggleService(serviceId) {
            const button = document.getElementById(serviceId + 'Btn');
            const hiddenInput = document.getElementById(serviceId);
            
            if (button.classList.contains('selected')) {
                button.classList.remove('selected');
                hiddenInput.value = '';
            } else {
                button.classList.add('selected');
                hiddenInput.value = 'true';
            }
            
            calculateCosts();
        }

        // Booking modal functions
        function openBookingModal(castleId) {
            const castle = bounceCastles.find(c => c.id === castleId);
            document.getElementById('selectedCastle').value = castle.name;
            document.getElementById('bookingModal').classList.remove('hidden');
            
            // Show/hide pool option based on castle
            const poolBtn = document.getElementById('poolBtn');
            if (castle.poolExtra) {
                poolBtn.classList.remove('hidden');
            } else {
                poolBtn.classList.add('hidden');
            }
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('startDate').min = today;
            document.getElementById('endDate').min = today;
            
            // Add event listeners for real-time calculation and booking check
            ['startDate', 'endDate', 'discountPercent', 'discountAmount'].forEach(id => {
                const element = document.getElementById(id);
                // Remove existing listeners to avoid duplicates
                element.removeEventListener('input', calculateCosts);
                element.removeEventListener('change', calculateCosts);
                element.removeEventListener('input', checkBookingAvailability);
                element.removeEventListener('change', checkBookingAvailability);
                // Add new listeners
                element.addEventListener('input', calculateCosts);
                element.addEventListener('change', calculateCosts);
                if (id === 'startDate' || id === 'endDate') {
                    element.addEventListener('input', checkBookingAvailability);
                    element.addEventListener('change', checkBookingAvailability);
                }
            });
            
            // Auto-calculate distance when address changes
            const addressElement = document.getElementById('address');
            addressElement.removeEventListener('input', handleAddressInput);
            addressElement.addEventListener('input', handleAddressInput);
            
            // Store castle ID for later use
            document.getElementById('bookingForm').dataset.castleId = castleId;
            
            // Initial calculation
            calculateCosts();
        }
        
        function handleAddressInput() {
            if (this.value.length > 5) {
                calculateDistance();
            } else {
                document.getElementById('distance').value = '';
                document.getElementById('travelCostInfo').innerHTML = '';
                calculateCosts();
            }
        }

        function closeBookingModal() {
            document.getElementById('bookingModal').classList.add('hidden');
            document.getElementById('bookingForm').reset();
            document.getElementById('costBreakdown').innerHTML = '';
            document.getElementById('totalCost').textContent = '0,00 ‚Ç¨';
            document.getElementById('travelCostInfo').innerHTML = '';
            document.getElementById('distance').value = '';
            
            // Remove booking warning if exists
            const existingWarning = document.getElementById('bookingWarning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            // Reset button selections
            document.getElementById('grassBtn').classList.remove('selected');
            document.getElementById('asphaltBtn').classList.remove('selected');
            document.getElementById('kabeltrommelBtn').classList.remove('selected');
            document.getElementById('aufbauServiceBtn').classList.remove('selected');
            document.getElementById('poolBtn').classList.remove('selected');
            
            // Reset hidden inputs
            document.getElementById('surface').value = '';
            document.getElementById('asphaltPauschale').value = '';
            document.getElementById('kabeltrommel').value = '';
            document.getElementById('aufbauService').value = '';
            document.getElementById('pool').value = '';
            
            // Reset material checkboxes
            document.querySelectorAll('.material-checkbox').forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('additionalMaterials').value = '';
            
            // Re-enable submit button
            const submitBtn = document.querySelector('button[type="submit"]');
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                submitBtn.classList.add('hover:bg-green-600');
            }
        }

        // Date and pricing calculations
        function isWeekend(date) {
            const day = new Date(date).getDay();
            return day === 5 || day === 6 || day === 0; // Friday, Saturday, Sunday
        }

        function calculateDaysBetween(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const diffTime = Math.abs(end - start);
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
        }

        function isEarlyBooking(startDate) {
            const start = new Date(startDate);
            const today = new Date();
            const diffWeeks = (start - today) / (1000 * 60 * 60 * 24 * 7);
            return diffWeeks >= 8;
        }

        function calculateDistance() {
            const address = document.getElementById('address').value.toLowerCase();
            if (!address || address.length < 5) {
                return;
            }
            
            // Base location: Bottroper Str. 146, 45964 Gladbeck
            let estimatedDistance = 15; // Default fallback
            
            // Distance estimation based on postal codes and city names
            const locationData = {
                // Gladbeck and immediate surroundings (0-3km)
                '45964': 1, '45966': 2, 'gladbeck': 1,
                
                // Close cities (3-5km)
                '45968': 4, '45970': 4, 'bottrop': 4, '46236': 4, '46238': 4,
                
                // Medium distance (5-10km)
                '45879': 7, '45881': 8, 'gelsenkirchen': 8, '45883': 9, '45885': 9,
                '46240': 7, '46242': 8, 'bottrop-kirchhellen': 9,
                '45711': 6, '45713': 7, 'datteln': 7,
                '45721': 8, '45723': 9, 'haltern': 9,
                
                // Larger distance (10-20km)
                '45894': 12, '45896': 13, '45898': 14, 'gelsenkirchen-buer': 12,
                '44575': 15, '44577': 16, 'castrop-rauxel': 15,
                '45699': 11, '45701': 12, 'herten': 11,
                '46284': 13, '46286': 14, 'dorsten': 13,
                '45657': 16, '45659': 17, 'recklinghausen': 16,
                '45661': 18, '45663': 19, '45665': 18,
                
                // Far distances (20km+)
                '44623': 22, '44625': 23, '44627': 24, 'herne': 22,
                '44629': 25, '44631': 26, '44633': 27,
                '44135': 28, '44137': 29, '44139': 30, 'dortmund': 28,
                '44141': 31, '44143': 32, '44145': 33,
                '45127': 25, '45129': 26, 'essen': 25,
                '45131': 27, '45133': 28, '45135': 29,
                '47051': 35, '47053': 36, 'duisburg': 35,
                '40210': 40, '40212': 41, 'd√ºsseldorf': 40,
                '50667': 45, '50668': 46, 'k√∂ln': 45,
                '48143': 50, '48145': 51, 'm√ºnster': 50,
                '44787': 20, '44789': 21, 'bochum': 20,
                '58089': 35, '58091': 36, 'hagen': 35,
                '42103': 30, '42105': 31, 'wuppertal': 30,
                '40474': 32, '40476': 33, 'd√ºsseldorf-nord': 32
            };
            
            // Check for postal codes (5 digits)
            const postalMatch = address.match(/\b(\d{5})\b/);
            if (postalMatch) {
                const postal = postalMatch[1];
                if (locationData[postal]) {
                    estimatedDistance = locationData[postal];
                }
            }
            
            // Check for city names if no postal code match
            if (!postalMatch || !locationData[postalMatch[1]]) {
                for (const [location, distance] of Object.entries(locationData)) {
                    if (isNaN(location) && address.includes(location)) {
                        estimatedDistance = distance;
                        break;
                    }
                }
            }
            
            // Add some variation for streets within same city
            const variation = Math.floor(Math.random() * 3) - 1; // -1, 0, or +1
            estimatedDistance = Math.max(1, estimatedDistance + variation);
            
            document.getElementById('distance').value = estimatedDistance;
            
            // Show travel cost info with more detailed feedback
            const travelCost = calculateTravelCost(estimatedDistance);
            let locationInfo = '';
            
            if (postalMatch) {
                locationInfo = `PLZ ${postalMatch[1]} erkannt`;
            } else {
                // Try to identify city from address
                const cityMatch = address.match(/\b(gladbeck|bottrop|gelsenkirchen|dortmund|essen|duisburg|d√ºsseldorf|k√∂ln|m√ºnster|bochum|hagen|wuppertal|herne|recklinghausen|dorsten|datteln|haltern|herten|castrop-rauxel)\b/);
                if (cityMatch) {
                    locationInfo = `${cityMatch[1].charAt(0).toUpperCase() + cityMatch[1].slice(1)} erkannt`;
                } else {
                    locationInfo = 'Gesch√§tzte Entfernung';
                }
            }
            
            document.getElementById('travelCostInfo').innerHTML = 
                `üìç ${locationInfo}: ${estimatedDistance} km von Bottroper Str. 146, 45964 Gladbeck<br>üí∞ Fahrtkosten: ${travelCost.toFixed(2)} ‚Ç¨`;
            
            calculateCosts();
        }

        function calculateTravelCost(distance) {
            if (distance <= 3) return settings.travel0to3;
            if (distance <= 5) return settings.travel5;
            if (distance <= 10) return settings.travel10;
            if (distance <= 20) return settings.travel20;
            return distance * settings.travelPerKm;
        }

        function calculateCosts() {
            const castleId = parseInt(document.getElementById('bookingForm').dataset.castleId);
            const castle = bounceCastles.find(c => c.id === castleId);
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const surface = document.getElementById('surface').value;
            const distance = parseFloat(document.getElementById('distance').value) || 0;
            const discountPercent = parseFloat(document.getElementById('discountPercent').value) || 0;
            const discountAmount = parseFloat(document.getElementById('discountAmount').value) || 0;
            
            let totalCost = 0;
            let breakdown = [];
            
            // Calculate daily costs only if dates are available
            if (startDate && endDate && castle) {
                const days = calculateDaysBetween(startDate, endDate);
                let dailyCosts = 0;
                for (let i = 0; i < days; i++) {
                    const currentDate = new Date(startDate);
                    currentDate.setDate(currentDate.getDate() + i);
                    const price = isWeekend(currentDate) ? castle.weekendPrice : castle.weekdayPrice;
                    dailyCosts += price;
                }
                
                breakdown.push(`H√ºpfburg (${days} Tag${days > 1 ? 'e' : ''}): ${dailyCosts.toFixed(2)} ‚Ç¨`);
                totalCost += dailyCosts;
            }
            
            // Additional services (always check these)
            if (document.getElementById('asphaltPauschale').value === 'true') {
                totalCost += settings.asphaltFee;
                breakdown.push(`Asphalt Pauschale: ${settings.asphaltFee.toFixed(2)} ‚Ç¨`);
            }
            if (document.getElementById('kabeltrommel').value === 'true') {
                totalCost += settings.cableFee;
                breakdown.push(`Kabeltrommel: ${settings.cableFee.toFixed(2)} ‚Ç¨`);
            }
            if (document.getElementById('aufbauService').value === 'true') {
                totalCost += settings.serviceFee;
                breakdown.push(`Auf-/Abbau Service: ${settings.serviceFee.toFixed(2)} ‚Ç¨`);
            }
            if (document.getElementById('pool').value === 'true' && castle && castle.poolExtra) {
                totalCost += castle.poolExtra;
                breakdown.push(`Pool: ${castle.poolExtra.toFixed(2)} ‚Ç¨`);
            }
            
            // Travel costs based on actual distance
            if (distance > 0) {
                const travelCost = calculateTravelCost(distance);
                totalCost += travelCost;
                breakdown.push(`Fahrtkosten (${distance} km): ${travelCost.toFixed(2)} ‚Ç¨`);
            }
            
            // Early booking discount
            let earlyBookingDiscount = 0;
            if (startDate && isEarlyBooking(startDate)) {
                earlyBookingDiscount = totalCost * 0.1;
                breakdown.push(`Fr√ºhbucher-Rabatt (10%): -${earlyBookingDiscount.toFixed(2)} ‚Ç¨`);
            }
            
            // Manual discounts
            let manualDiscount = 0;
            if (discountPercent > 0) {
                manualDiscount = totalCost * (discountPercent / 100);
                breakdown.push(`Rabatt (${discountPercent}%): -${manualDiscount.toFixed(2)} ‚Ç¨`);
            }
            if (discountAmount > 0) {
                manualDiscount += discountAmount;
                breakdown.push(`Rabatt (Betrag): -${discountAmount.toFixed(2)} ‚Ç¨`);
            }
            
            totalCost = Math.max(0, totalCost - earlyBookingDiscount - manualDiscount);
            
            // Update UI
            document.getElementById('costBreakdown').innerHTML = breakdown.map(item => 
                `<div class="flex justify-between"><span>${item.split(':')[0]}:</span><span>${item.split(':')[1]}</span></div>`
            ).join('');
            document.getElementById('totalCost').textContent = `${totalCost.toFixed(2)} ‚Ç¨`;
        }

        // Check for double bookings
        function checkDoubleBooking(castleId, startDate, endDate) {
            const newStart = new Date(startDate);
            const newEnd = new Date(endDate);
            
            return orders.some(order => {
                // Skip cancelled orders
                if (order.cancelled) return false;
                if (order.castleId !== castleId) return false;
                
                const existingStart = new Date(order.startDate);
                const existingEnd = new Date(order.endDate);
                
                // Check if dates overlap
                return (newStart <= existingEnd && newEnd >= existingStart);
            });
        }

        // Real-time booking availability check
        function checkBookingAvailability() {
            const castleId = parseInt(document.getElementById('bookingForm').dataset.castleId);
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            // Remove existing warning
            const existingWarning = document.getElementById('bookingWarning');
            if (existingWarning) {
                existingWarning.remove();
            }
            
            if (startDate && endDate && castleId) {
                if (checkDoubleBooking(castleId, startDate, endDate)) {
                    // Find conflicting booking
                    const conflictingOrder = orders.find(order => {
                        // Skip cancelled orders
                        if (order.cancelled) return false;
                        if (order.castleId !== castleId) return false;
                        const newStart = new Date(startDate);
                        const newEnd = new Date(endDate);
                        const existingStart = new Date(order.startDate);
                        const existingEnd = new Date(order.endDate);
                        return (newStart <= existingEnd && newEnd >= existingStart);
                    });
                    
                    // Add warning message
                    const warningDiv = document.createElement('div');
                    warningDiv.id = 'bookingWarning';
                    warningDiv.className = 'bg-red-50 border-l-4 border-red-400 p-4 mt-4 rounded-lg';
                    warningDiv.innerHTML = `
                        <div class="flex items-center">
                            <div class="text-red-400 text-xl mr-3">‚ö†Ô∏è</div>
                            <div>
                                <h4 class="text-red-800 font-semibold">Doppelbuchung erkannt!</h4>
                                <p class="text-red-700 text-sm mt-1">
                                    Diese H√ºpfburg ist bereits vom ${conflictingOrder.startDate} bis ${conflictingOrder.endDate} 
                                    an ${conflictingOrder.customerName} vermietet.
                                </p>
                                <p class="text-red-600 text-xs mt-2">Bitte w√§hlen Sie andere Daten oder eine andere H√ºpfburg.</p>
                            </div>
                        </div>
                    `;
                    
                    // Insert warning after the date fields
                    const endDateField = document.getElementById('endDate').parentElement.parentElement;
                    endDateField.parentNode.insertBefore(warningDiv, endDateField.nextSibling);
                    
                    // Disable submit button
                    const submitBtn = document.querySelector('button[type="submit"]');
                    submitBtn.disabled = true;
                    submitBtn.classList.add('opacity-50', 'cursor-not-allowed');
                    submitBtn.classList.remove('hover:bg-green-600');
                } else {
                    // Enable submit button
                    const submitBtn = document.querySelector('button[type="submit"]');
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                    submitBtn.classList.add('hover:bg-green-600');
                }
            }
        }

        // Form submission
        document.getElementById('bookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const castleId = parseInt(this.dataset.castleId);
            const castle = bounceCastles.find(c => c.id === castleId);
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            // Check for double booking
            if (checkDoubleBooking(castleId, startDate, endDate)) {
                alert('‚ùå Doppelbuchung erkannt!\n\nDiese H√ºpfburg ist bereits f√ºr den gew√§hlten Zeitraum gebucht.\nBitte w√§hlen Sie andere Daten oder eine andere H√ºpfburg.');
                return;
            }
            
            // Collect selected materials
            const selectedMaterials = [];
            document.querySelectorAll('.material-checkbox:checked').forEach(checkbox => {
                const materialName = checkbox.parentElement.querySelector('span').textContent;
                selectedMaterials.push(materialName);
            });

            const order = {
                id: Date.now(),
                castleId: castleId,
                castleName: castle.name,
                customerName: document.getElementById('customerName').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                setupTime: document.getElementById('setupTime').value,
                teardownTime: document.getElementById('teardownTime').value,
                surface: document.getElementById('surface').value,
                address: document.getElementById('address').value,
                distance: parseFloat(document.getElementById('distance').value) || 0,
                additionalServices: {
                    pauschale: document.getElementById('asphaltPauschale').value === 'true',
                    kabeltrommel: document.getElementById('kabeltrommel').value === 'true',
                    aufbauService: document.getElementById('aufbauService').value === 'true',
                    pool: document.getElementById('pool').value === 'true'
                },
                materials: {
                    selected: selectedMaterials,
                    additional: document.getElementById('additionalMaterials').value
                },
                discountPercent: parseFloat(document.getElementById('discountPercent').value) || 0,
                discountAmount: parseFloat(document.getElementById('discountAmount').value) || 0,
                totalCost: parseFloat(document.getElementById('totalCost').textContent.replace(' ‚Ç¨', '').replace(',', '.')),
                earlyBooking: isEarlyBooking(document.getElementById('startDate').value),
                createdAt: new Date().toISOString()
            };
            
            orders.push(order);
            saveData();
            closeBookingModal();
            showBookingConfirmation(order);
            renderBounceCastles();
        });

        // Show booking confirmation
        function showBookingConfirmation(order) {
            const summary = document.getElementById('bookingSummary');
            
            // Calculate detailed breakdown for confirmation
            const castle = bounceCastles.find(c => c.id === order.castleId);
            const days = calculateDaysBetween(order.startDate, order.endDate);
            let dailyCosts = 0;
            let dailyBreakdown = [];
            
            for (let i = 0; i < days; i++) {
                const currentDate = new Date(order.startDate);
                currentDate.setDate(currentDate.getDate() + i);
                const price = isWeekend(currentDate) ? castle.weekendPrice : castle.weekdayPrice;
                const dayName = currentDate.toLocaleDateString('de-DE', { weekday: 'short', day: '2-digit', month: '2-digit' });
                const dayType = isWeekend(currentDate) ? 'Wochenende' : 'Wochentag';
                dailyBreakdown.push(`${dayName} (${dayType}): ${price}‚Ç¨`);
                dailyCosts += price;
            }
            
            let costBreakdown = [];
            let subtotal = dailyCosts;
            
            // Additional services
            if (order.additionalServices.pauschale) {
                costBreakdown.push(`Asphalt Pauschale: +${settings.asphaltFee.toFixed(2)} ‚Ç¨`);
                subtotal += settings.asphaltFee;
            }
            if (order.additionalServices.kabeltrommel) {
                costBreakdown.push(`Kabeltrommel: +${settings.cableFee.toFixed(2)} ‚Ç¨`);
                subtotal += settings.cableFee;
            }
            if (order.additionalServices.aufbauService) {
                costBreakdown.push(`Auf-/Abbau Service: +${settings.serviceFee.toFixed(2)} ‚Ç¨`);
                subtotal += settings.serviceFee;
            }
            if (order.additionalServices.pool && castle.poolExtra) {
                costBreakdown.push(`Pool: +${castle.poolExtra.toFixed(2)} ‚Ç¨`);
                subtotal += castle.poolExtra;
            }
            
            // Travel costs
            if (order.distance > 0) {
                const travelCost = calculateTravelCost(order.distance);
                costBreakdown.push(`Fahrtkosten (${order.distance} km): +${travelCost.toFixed(2)} ‚Ç¨`);
                subtotal += travelCost;
            }
            
            // Discounts
            let totalDiscount = 0;
            if (order.earlyBooking) {
                const earlyDiscount = subtotal * 0.1;
                costBreakdown.push(`Fr√ºhbucher-Rabatt (10%): -${earlyDiscount.toFixed(2)} ‚Ç¨`);
                totalDiscount += earlyDiscount;
            }
            if (order.discountPercent > 0) {
                const percentDiscount = subtotal * (order.discountPercent / 100);
                costBreakdown.push(`Rabatt (${order.discountPercent}%): -${percentDiscount.toFixed(2)} ‚Ç¨`);
                totalDiscount += percentDiscount;
            }
            if (order.discountAmount > 0) {
                costBreakdown.push(`Rabatt (Betrag): -${order.discountAmount.toFixed(2)} ‚Ç¨`);
                totalDiscount += order.discountAmount;
            }
            
            summary.innerHTML = `
                <div class="space-y-6">
                    <!-- Header -->
                    <div class="text-center border-b pb-4">
                        <h4 class="text-lg font-bold text-gray-800">Buchungsbest√§tigung</h4>
                        <p class="text-sm text-gray-500">Auftrag #${order.id}</p>
                    </div>
                    
                    <!-- Customer & Castle Info -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div class="space-y-2">
                            <h5 class="font-semibold text-gray-700 border-b pb-1">Kunde & H√ºpfburg</h5>
                            <p><span class="text-gray-600">Kunde:</span> <span class="font-medium">${order.customerName}</span></p>
                            <p><span class="text-gray-600">H√ºpfburg:</span> <span class="font-medium">${order.castleName}</span></p>
                            <p><span class="text-gray-600">Untergrund:</span> <span class="font-medium">${order.surface === 'grass' ? 'üå± Rasen' : 'üõ£Ô∏è Asphalt'}</span></p>
                        </div>
                        <div class="space-y-2">
                            <h5 class="font-semibold text-gray-700 border-b pb-1">Termine & Ort</h5>
                            <p><span class="text-gray-600">Zeitraum:</span> <span class="font-medium">${order.startDate} bis ${order.endDate}</span></p>
                            <p><span class="text-gray-600">Aufbau:</span> <span class="font-medium">${order.setupTime} Uhr</span></p>
                            <p><span class="text-gray-600">Abbau:</span> <span class="font-medium">${order.teardownTime} Uhr</span></p>
                            <p><span class="text-gray-600">Adresse:</span> <span class="font-medium">${order.address}</span></p>
                            ${order.distance > 0 ? `<p><span class="text-gray-600">Entfernung:</span> <span class="font-medium">${order.distance} km</span></p>` : ''}
                        </div>
                    </div>
                    
                    <!-- Materials Section -->
                    ${order.materials && (order.materials.selected.length > 0 || order.materials.additional) ? `
                    <div class="bg-blue-50 rounded-lg p-4">
                        <h5 class="font-semibold text-blue-800 mb-3">üì¶ Ben√∂tigte Materialien</h5>
                        ${order.materials.selected.length > 0 ? `
                        <div class="mb-3">
                            <p class="text-sm font-medium text-blue-700 mb-2">Standard Materialien:</p>
                            <div class="grid grid-cols-2 gap-2">
                                ${order.materials.selected.map(material => `<div class="text-sm text-blue-600">‚Ä¢ ${material}</div>`).join('')}
                            </div>
                        </div>
                        ` : ''}
                        ${order.materials.additional ? `
                        <div>
                            <p class="text-sm font-medium text-blue-700 mb-2">Zus√§tzliche Materialien / Notizen:</p>
                            <div class="text-sm text-blue-600 bg-white p-2 rounded border">${order.materials.additional}</div>
                        </div>
                        ` : ''}
                    </div>
                    ` : ''}
                    
                    <!-- Detailed Cost Breakdown -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h5 class="font-semibold text-gray-700 mb-3">Kostenaufstellung</h5>
                        
                        <!-- Daily Costs -->
                        <div class="mb-4">
                            <p class="font-medium text-gray-700 mb-2">H√ºpfburg Miete (${days} Tag${days > 1 ? 'e' : ''}):</p>
                            <div class="ml-4 space-y-1 text-sm">
                                ${dailyBreakdown.map(day => `<div class="flex justify-between"><span>${day.split(':')[0]}:</span><span>${day.split(':')[1]}</span></div>`).join('')}
                            </div>
                            <div class="flex justify-between font-medium mt-2 pt-2 border-t border-gray-300">
                                <span>Zwischensumme Miete:</span>
                                <span>${dailyCosts.toFixed(2)} ‚Ç¨</span>
                            </div>
                        </div>
                        
                        <!-- Additional Services & Costs -->
                        ${costBreakdown.length > 0 ? `
                        <div class="space-y-1 text-sm mb-4">
                            ${costBreakdown.map(item => `<div class="flex justify-between"><span>${item.split(':')[0]}:</span><span>${item.split(':')[1]}</span></div>`).join('')}
                        </div>
                        ` : ''}
                        
                        <!-- Total -->
                        <div class="border-t-2 border-gray-400 pt-3 mt-4">
                            <div class="flex justify-between text-xl font-bold">
                                <span>Gesamtsumme:</span>
                                <span class="text-green-600">${order.totalCost.toFixed(2)} ‚Ç¨</span>
                            </div>
                            ${totalDiscount > 0 ? `
                            <div class="text-sm text-green-600 mt-1">
                                (Ersparnis: ${totalDiscount.toFixed(2)} ‚Ç¨)
                            </div>
                            ` : ''}
                        </div>
                    </div>
                    
                    <!-- Footer Note -->
                    <div class="text-center text-sm text-gray-500 bg-blue-50 p-3 rounded-lg">
                        üìã Diese Buchung wurde erfolgreich gespeichert und ist ab sofort in der Auftrags√ºbersicht verf√ºgbar.
                    </div>
                </div>
            `;
            
            document.getElementById('confirmationModal').classList.remove('hidden');
        }

        // Close confirmation modal
        function closeConfirmationModal() {
            document.getElementById('confirmationModal').classList.add('hidden');
        }

        // Render orders
        function renderOrders() {
            const container = document.getElementById('ordersList');
            container.innerHTML = '';
            
            if (orders.length === 0) {
                container.innerHTML = '<div class="p-6 text-center text-gray-500">Keine Auftr√§ge vorhanden</div>';
                return;
            }
            
            orders.forEach(order => {
                const discountApplied = order.discountPercent > 0 || order.discountAmount > 0 || order.earlyBooking;
                const isActive = !order.cancelled && new Date(order.endDate) >= new Date();
                const isPast = !order.cancelled && new Date(order.endDate) < new Date();
                
                let statusBadge = '';
                let statusColor = '';
                
                if (order.cancelled) {
                    statusBadge = 'Storniert';
                    statusColor = 'bg-red-100 text-red-800';
                } else if (isPast) {
                    statusBadge = 'Abgeschlossen';
                    statusColor = 'bg-gray-100 text-gray-800';
                } else {
                    statusBadge = 'Aktiv';
                    statusColor = 'bg-green-100 text-green-800';
                }
                
                container.innerHTML += `
                    <div class="p-6 ${order.cancelled ? 'opacity-75' : ''}">
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <div class="flex items-center space-x-3 mb-2">
                                    <h4 class="font-semibold text-lg text-gray-800 ${order.cancelled ? 'line-through' : ''}">${order.customerName}</h4>
                                    <span class="px-2 py-1 rounded-full text-xs font-medium ${statusColor}">${statusBadge}</span>
                                </div>
                                <p class="text-gray-600">${order.castleName}</p>
                                <p class="text-sm text-gray-500">${order.startDate} bis ${order.endDate}</p>
                                <p class="text-sm text-gray-500">${order.address}</p>
                                ${order.cancelled ? `<p class="text-xs text-red-600 mt-2">Storniert am: ${new Date(order.cancelledAt).toLocaleDateString('de-DE')}</p>` : ''}
                            </div>
                            <div class="text-right">
                                <p class="text-xl font-bold ${order.cancelled ? 'text-red-600 line-through' : 'text-green-600'}">${order.totalCost.toFixed(2)} ‚Ç¨</p>
                                <p class="text-sm ${discountApplied ? 'text-orange-600' : 'text-gray-500'}">
                                    Rabatt: ${discountApplied ? 'Ja' : 'Nein'}
                                </p>
                                ${!order.cancelled ? `
                                <button onclick="cancelOrder(${order.id})" 
                                        class="mt-2 px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-xs rounded-lg transition-colors">
                                    Stornieren
                                </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Cancel order function
        function cancelOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) {
                alert('Auftrag nicht gefunden!');
                return;
            }
            
            if (order.cancelled) {
                alert('Dieser Auftrag ist bereits storniert!');
                return;
            }
            
            // Show custom confirmation modal
            showCancelConfirmation(order);
        }

        // Show cancel confirmation modal
        function showCancelConfirmation(order) {
            // Create modal HTML
            const modalHTML = `
                <div id="cancelModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
                        <div class="p-6">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4">‚ö†Ô∏è</div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-2">Auftrag stornieren?</h3>
                                <p class="text-gray-600">Diese Aktion kann nicht r√ºckg√§ngig gemacht werden!</p>
                            </div>

                            <div class="bg-gray-50 rounded-lg p-4 mb-6 space-y-2">
                                <p><strong>Kunde:</strong> ${order.customerName}</p>
                                <p><strong>H√ºpfburg:</strong> ${order.castleName}</p>
                                <p><strong>Zeitraum:</strong> ${order.startDate} bis ${order.endDate}</p>
                                <p><strong>Betrag:</strong> ${order.totalCost.toFixed(2)} ‚Ç¨</p>
                            </div>

                            <div class="flex space-x-4">
                                <button onclick="confirmCancellation(${order.id})" 
                                        class="flex-1 bg-red-500 hover:bg-red-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors">
                                    ‚úÖ Ja, stornieren
                                </button>
                                <button onclick="closeCancelModal()" 
                                        class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 font-semibold py-3 px-6 rounded-lg transition-colors">
                                    ‚ùå Nein, behalten
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Add modal to page
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        // Confirm cancellation
        function confirmCancellation(orderId) {
            const order = orders.find(o => o.id === orderId);
            
            // Mark order as cancelled
            order.cancelled = true;
            order.cancelledAt = new Date().toISOString();
            
            // Save to localStorage
            saveData();
            
            // Update all displays
            updateCastleStatuses();
            renderOrders();
            renderBounceCastles();
            if (currentUser === 'employee') {
                renderEmployeeBookings();
            }
            
            // Close modal
            closeCancelModal();
            
            // Show success message
            alert(`‚úÖ Auftrag erfolgreich storniert!\n\nDie H√ºpfburg "${order.castleName}" ist nun wieder f√ºr den Zeitraum ${order.startDate} bis ${order.endDate} verf√ºgbar.`);
        }

        // Close cancel modal
        function closeCancelModal() {
            const modal = document.getElementById('cancelModal');
            if (modal) {
                modal.remove();
            }
        }

        // Employee functions
        function renderEmployeeBookings() {
            const container = document.getElementById('employeeBookingsList');
            container.innerHTML = '';
            
            const activeOrders = orders.filter(order => {
                const endDate = new Date(order.endDate);
                const today = new Date();
                return !order.cancelled && endDate >= today;
            });
            
            if (activeOrders.length === 0) {
                container.innerHTML = '<div class="bg-white rounded-lg shadow-lg p-6 text-center text-gray-500">Keine aktiven Buchungen</div>';
                return;
            }
            
            activeOrders.forEach(order => {
                const hasMaterials = order.materials && (order.materials.selected.length > 0 || order.materials.additional);
                
                container.innerHTML += `
                    <div class="bg-white rounded-lg shadow-lg p-6">
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">${order.castleName}</h3>
                                <p class="text-gray-600">Kunde: ${order.customerName}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-lg font-semibold text-green-600">${order.totalCost.toFixed(2)} ‚Ç¨</p>
                                ${hasMaterials ? '<div class="text-xs text-blue-600 font-medium mt-1">üì¶ Materialien erforderlich</div>' : ''}
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm mb-4">
                            <div>
                                <p><strong>Zeitraum:</strong> ${order.startDate} bis ${order.endDate}</p>
                                <p><strong>Aufbau:</strong> ${order.setupTime}</p>
                                <p><strong>Abbau:</strong> ${order.teardownTime}</p>
                            </div>
                            <div>
                                <p><strong>Untergrund:</strong> ${order.surface === 'grass' ? 'Rasen' : 'Asphalt'}</p>
                                <p><strong>Adresse:</strong> ${order.address}</p>
                                ${order.distance > 0 ? `<p><strong>Entfernung:</strong> ${order.distance} km</p>` : ''}
                            </div>
                        </div>
                        
                        ${hasMaterials ? `
                        <div class="bg-blue-50 rounded-lg p-4 border-l-4 border-blue-400">
                            <h4 class="font-semibold text-blue-800 mb-3 flex items-center">
                                üì¶ Mitzubringende Materialien
                            </h4>
                            ${order.materials.selected.length > 0 ? `
                            <div class="mb-3">
                                <p class="text-sm font-medium text-blue-700 mb-2">Standard Materialien:</p>
                                <div class="grid grid-cols-2 md:grid-cols-3 gap-1">
                                    ${order.materials.selected.map(material => `
                                        <label class="flex items-center space-x-2 text-sm text-blue-600">
                                            <input type="checkbox" class="material-check" data-order="${order.id}">
                                            <span>${material}</span>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                            ` : ''}
                            ${order.materials.additional ? `
                            <div class="bg-white p-3 rounded border">
                                <p class="text-sm font-medium text-blue-700 mb-1">Zus√§tzliche Materialien / Notizen:</p>
                                <p class="text-sm text-blue-600">${order.materials.additional}</p>
                            </div>
                            ` : ''}
                        </div>
                        ` : ''}
                        
                        ${order.additionalServices.aufbauService ? `
                        <div class="mt-4 bg-green-50 p-3 rounded-lg border-l-4 border-green-400">
                            <p class="text-sm font-medium text-green-700">üîß Auf-/Abbau Service gebucht</p>
                            <p class="text-xs text-green-600">Vollst√§ndiger Aufbau und Abbau durch unser Team</p>
                        </div>
                        ` : ''}
                    </div>
                `;
            });
        }

        // Settings functions
        function loadSettingsToForm() {
            document.getElementById('asphaltFee').value = settings.asphaltFee;
            document.getElementById('cableFee').value = settings.cableFee;
            document.getElementById('serviceFee').value = settings.serviceFee;
            document.getElementById('travel0to3').value = settings.travel0to3;
            document.getElementById('travel5').value = settings.travel5;
            document.getElementById('travel10').value = settings.travel10;
            document.getElementById('travel20').value = settings.travel20;
            document.getElementById('travelPerKm').value = settings.travelPerKm;
        }

        function saveSettings() {
            settings.asphaltFee = parseFloat(document.getElementById('asphaltFee').value);
            settings.cableFee = parseFloat(document.getElementById('cableFee').value);
            settings.serviceFee = parseFloat(document.getElementById('serviceFee').value);
            settings.travel0to3 = parseFloat(document.getElementById('travel0to3').value);
            settings.travel5 = parseFloat(document.getElementById('travel5').value);
            settings.travel10 = parseFloat(document.getElementById('travel10').value);
            settings.travel20 = parseFloat(document.getElementById('travel20').value);
            settings.travelPerKm = parseFloat(document.getElementById('travelPerKm').value);
            
            saveData();
            alert('Einstellungen gespeichert!');
        }

        // Export/Import functions
        function exportOrders() {
            const exportData = {
                orders: orders,
                bounceCastles: bounceCastles,
                settings: settings,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `party-crasher-export-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        function importData() {
            document.getElementById('importModal').classList.remove('hidden');
        }

        function closeImportModal() {
            document.getElementById('importModal').classList.add('hidden');
            document.getElementById('jsonInput').value = '';
        }

        function processJsonImport() {
            const jsonText = document.getElementById('jsonInput').value.trim();
            
            if (!jsonText) {
                alert('Bitte JSON Daten eingeben!');
                return;
            }
            
            try {
                const importData = JSON.parse(jsonText);
                
                if (importData.orders) orders = importData.orders;
                if (importData.bounceCastles) bounceCastles = importData.bounceCastles;
                if (importData.settings) settings = Object.assign(settings, importData.settings);
                
                saveData();
                renderEmployeeBookings();
                closeImportModal();
                alert('Daten erfolgreich importiert!');
            } catch (error) {
                alert('Fehler beim Importieren: Ung√ºltiges JSON Format!\n\nBitte √ºberpr√ºfen Sie die Syntax.');
            }
        }

        // Initialize app on load
        init();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'974bdf2f414d4151',t:'MTc1NjEzMzExMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
